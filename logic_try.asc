Version 4.1
SHEET 1 5376 2840
WIRE 400 336 272 336
WIRE 832 336 704 336
WIRE 1136 336 1008 336
WIRE 32 368 -64 368
WIRE 272 416 272 336
WIRE 704 416 704 336
WIRE 1008 416 1008 336
WIRE 32 432 32 368
WIRE 32 576 32 512
WIRE 272 576 272 496
WIRE 704 576 704 496
WIRE 1008 576 1008 496
WIRE 544 800 496 800
WIRE 1360 800 1312 800
WIRE -128 832 -176 832
WIRE 544 848 544 800
WIRE 1360 848 1360 800
WIRE -128 880 -128 832
WIRE 704 912 640 912
WIRE 1008 912 704 912
WIRE 1072 912 1008 912
WIRE 1264 912 1184 912
WIRE 272 944 -32 944
WIRE 448 944 352 944
WIRE 1552 944 1456 944
WIRE 1696 944 1632 944
WIRE -224 976 -272 976
WIRE 704 976 640 976
WIRE 864 976 704 976
WIRE 1072 976 1184 912
WIRE 1072 976 864 976
WIRE 1184 976 1072 912
WIRE 1264 976 1184 976
WIRE 64 1008 -32 1008
WIRE 192 1008 144 1008
WIRE 1696 1024 1696 944
WIRE 192 1040 192 1008
WIRE 720 1040 640 1040
WIRE 1264 1040 1184 1040
WIRE 864 1056 864 976
WIRE 1008 1056 1008 912
WIRE 48 1072 -32 1072
WIRE 720 1088 720 1040
WIRE 1184 1088 1184 1040
WIRE 48 1104 48 1072
WIRE 864 1152 864 1120
WIRE 1008 1152 1008 1120
WIRE 544 1184 544 1152
WIRE 1360 1184 1360 1152
WIRE -128 1216 -128 1184
WIRE 752 1440 672 1440
WIRE 864 1440 832 1440
WIRE 1008 1440 944 1440
WIRE 48 1520 0 1520
WIRE 912 1536 848 1536
WIRE 480 1552 432 1552
WIRE 672 1552 672 1440
WIRE 672 1552 560 1552
WIRE 720 1552 672 1552
WIRE 48 1568 48 1520
WIRE 880 1568 848 1568
WIRE 720 1584 640 1584
WIRE 1008 1600 1008 1440
WIRE 1008 1600 848 1600
WIRE 1056 1600 1008 1600
WIRE 48 1696 48 1648
WIRE 144 1696 48 1696
WIRE 48 1728 48 1696
WIRE 752 1744 672 1744
WIRE 864 1744 832 1744
WIRE 1008 1744 944 1744
WIRE 912 1840 848 1840
WIRE 480 1856 432 1856
WIRE 672 1856 672 1744
WIRE 672 1856 560 1856
WIRE 720 1856 672 1856
WIRE 880 1872 848 1872
WIRE 48 1888 48 1808
WIRE 720 1888 640 1888
WIRE 1008 1904 1008 1744
WIRE 1008 1904 848 1904
WIRE 1056 1904 1008 1904
FLAG -128 1216 0
FLAG -176 832 vldo
FLAG -272 976 ltc_out
FLAG 192 1040 0
FLAG 544 1184 0
FLAG 496 800 vldo
FLAG 864 1152 0
FLAG 1008 1152 0
FLAG 704 976 vheart2
FLAG 704 912 vheart1
FLAG 1696 1024 0
FLAG 720 1088 switch_sgn_test
FLAG 1184 1088 switch_sgn_test
FLAG 272 576 0
FLAG 1312 800 vldo
FLAG 1360 1184 0
FLAG 400 336 switch_sgn_test
FLAG 0 1520 vldo
FLAG 144 1696 vref
FLAG 48 1888 0
FLAG 704 576 0
FLAG 832 336 ltc_out
FLAG 1008 576 0
FLAG 1136 336 vldo
FLAG 640 1584 vref
FLAG 432 1552 vheart1
FLAG 912 1536 vldo
FLAG 880 1568 0
FLAG 1056 1600 logic_C1
FLAG 640 1888 vref
FLAG 432 1856 vheart2
FLAG 912 1840 vldo
FLAG 880 1872 0
FLAG 1056 1904 logic_C2
FLAG 48 1104 logic_overcharge
FLAG 32 576 0
FLAG -64 368 logic_overcharge
SYMBOL Switches\\ADG819 -128 1024 M0
SYMATTR InstName U3
SYMBOL res 48 1024 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R_overcharge
SYMATTR Value 100k
SYMBOL cap 848 1056 R0
SYMATTR InstName C2_heart
SYMATTR Value 4.7µ
SYMBOL cap 992 1056 R0
SYMATTR InstName C1_heart
SYMATTR Value 4.7µ
SYMBOL res 1536 960 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName Trimmer_discharge
SYMATTR Value 100
SYMBOL voltage 272 400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V_test
SYMATTR Value PULSE(0 2.5 0 0 0 5m 10m)
SYMBOL Switches\\ADG819 544 992 M0
SYMATTR InstName U4
SYMBOL Switches\\ADG819 1360 992 R0
SYMATTR InstName U5
SYMBOL res 256 960 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName Trimmer_charge
SYMATTR Value 10
SYMBOL res 32 1552 R0
SYMATTR InstName R4
SYMATTR Value 1Meg
SYMBOL res 736 1456 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R7
SYMATTR Value 100k
SYMBOL res 32 1712 R0
SYMATTR InstName R5
SYMATTR Value 1Meg
SYMBOL voltage 704 400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V_ltc
SYMATTR Value 2.3
SYMBOL voltage 1008 400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V_ldo
SYMATTR Value 2.2
SYMBOL TLV3691 784 1568 R0
SYMATTR InstName U1
SYMBOL res 464 1568 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R6
SYMATTR Value 180k
SYMBOL res 848 1456 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R8
SYMATTR Value 120k
SYMBOL res 736 1760 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R10
SYMATTR Value 100k
SYMBOL TLV3691 784 1872 R0
SYMATTR InstName U2
SYMBOL res 464 1872 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R9
SYMATTR Value 180k
SYMBOL res 848 1760 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R11
SYMATTR Value 120k
SYMBOL res 16 416 R0
SYMATTR InstName R_pulldown
SYMATTR Value 100k
TEXT 272 216 Left 2 !.tran 50m startup
TEXT 1768 776 Left 2 ;Output from LTC3105 will charge one of the heartbeat capacitors\nWe need U3 to avoid overcharging the heartbeat capacitors\nU4 selects the capacitor to charge\nU5 works in parallel with U4 and discharges the other capacitor
TEXT 1768 1024 Left 2 ;C_heart is selected only based on this supposition:\n1) Tcharge < Tdischarge\nN.B.: it's important to respect the condition to guarantee continuous operation with environmental changes\n \nTo guarantee a rapid charge time we prefer a low capacitance... we can adjust the discharge time with the load\nFor now, since charging time < 1ms, load trimmer is based so that:\n1) discharge tau = 470us
TEXT 656 992 Left 2 !.ic V(vheart2) = 0
TEXT 656 928 Left 2 !.ic V(vheart1) = 0
TEXT -536 752 Left 2 ;ADG819:\nIN is high? -> S2 ON\nIN is low? -> S1 ON\n \nVIH (lowest) = 2V\nVIL (highest) = 0.8V
TEXT 696 840 Left 2 ;When one is charging, the other is discharging
TEXT 1768 920 Left 2 ;To kinda control the charging time of the capacitors, a small trimmer can be placed to limit the LTC output current\n(Small because we dont want to limit the charging current too much)\nAlso we want to guarantee safety when placing a load resistor/trimmer to easily respect the condition below
TEXT 1248 1456 Left 2 ;More details and calculus are in the notes\nCalculus done by considering:\n1) Vo(low) = 0\n2) Vo(high) = vldo = 2.2V\n3) Desired Vth_H = 2V\n4) Desired Vth_L = 0.2V\n \nWe solve the two equation system and we get Vref = 1.1V and R1/R2 = 9/11:\nSo we calculate the real Vth_H and Vth_L with these chosen parameters and we find:\n \nVth_H = 2V\nIt's good because it's higher than VIH (min) of ADG819 and it's in the TLV3691 input range\nAlso it's near to a full charge (Vin = ltc_out = 2.3V)\n \nVth_L = 0.2V\nIt's good because it's lower than VIL (max) of ADG819 and it's in the TLV3691 input range\nAlso it's near to a complete discharge\n \nN.B.: Finding the real Vth values might seem redundant...\nIn our scenario, with our desired Vth values, we were able to represent the exact ratios with voltage diveders and the E12 resistors
TEXT 272 248 Left 2 ;Currently trying with only one comparator per C_heart with a big schmitt trigger window\nIf this doesnt work, then go with 2 comparators
TEXT -192 2000 Left 2 ;By simulating:\n1) Logic_C1 and Logic_C2 work as expected although their Vo(low) is around 35 mV and Vo(high) is around 2.1V\n2) There is a small offset of about 100mV on the Vth values... maybe due to the model parameters
