Version 4.1
SHEET 1 4868 1296
WIRE 1664 -208 1600 -208
WIRE 1824 -208 1792 -208
WIRE 1824 -112 1824 -208
WIRE 1600 -80 1600 -208
WIRE 848 0 624 0
WIRE 1120 0 928 0
WIRE 1824 16 1824 -48
WIRE -16 96 -96 96
WIRE 96 96 -16 96
WIRE 496 96 224 96
WIRE 624 96 624 0
WIRE 624 96 496 96
WIRE 752 96 624 96
WIRE 1120 96 1120 0
WIRE 1120 96 1040 96
WIRE 624 112 624 96
WIRE 272 128 224 128
WIRE -96 144 -96 96
WIRE 272 176 272 128
WIRE 624 192 624 176
WIRE 1168 192 1040 192
WIRE 1296 192 1168 192
WIRE 1408 192 1296 192
WIRE 1600 192 1600 -16
WIRE 1600 192 1408 192
WIRE 1632 192 1600 192
WIRE 1776 192 1696 192
WIRE 1824 192 1776 192
WIRE 2064 192 1824 192
WIRE 2176 192 2064 192
WIRE 2192 192 2176 192
WIRE 2448 192 2384 192
WIRE 2512 192 2448 192
WIRE 2800 192 2512 192
WIRE 2912 192 2800 192
WIRE 3040 192 2976 192
WIRE 1296 224 1296 192
WIRE 1408 224 1408 192
WIRE 2064 224 2064 192
WIRE 2448 224 2448 192
WIRE 2800 224 2800 192
WIRE -96 288 -96 224
WIRE 624 288 592 288
WIRE 752 288 704 288
WIRE 1168 288 1040 288
WIRE 1824 288 1824 192
WIRE 1408 304 1408 288
WIRE 2176 304 2176 192
WIRE 2192 304 2176 304
WIRE 592 320 592 288
WIRE 2064 320 2064 288
WIRE 2448 320 2448 288
WIRE 1168 352 1168 288
WIRE 1296 352 1296 304
WIRE 1296 352 1168 352
WIRE 2800 352 2800 304
WIRE 3040 352 2800 352
WIRE 1104 384 1040 384
WIRE 1168 384 1104 384
WIRE 2288 384 2288 352
WIRE -96 400 -96 368
WIRE 1296 400 1296 352
WIRE 2800 400 2800 352
WIRE 1168 416 1168 384
WIRE 1824 416 1824 352
WIRE 704 480 640 480
WIRE 752 480 704 480
WIRE 1088 480 1040 480
WIRE 640 512 640 480
WIRE 1088 512 1088 480
WIRE 1168 512 1168 480
WIRE 1296 512 1296 480
WIRE 2800 544 2800 480
WIRE 896 560 896 528
WIRE 640 608 640 576
FLAG -96 400 0
FLAG 272 176 0
FLAG 496 96 solar_out
FLAG 896 560 0
FLAG 1088 512 0
FLAG 1168 512 0
FLAG 1296 512 0
FLAG 592 320 0
FLAG 624 192 0
FLAG 1408 304 0
FLAG 640 608 0
FLAG 704 480 vaux
FLAG 1168 192 ltc_out
FLAG 1104 384 vldo
FLAG 1824 416 0
FLAG 1776 192 vbackup
FLAG -16 96 irradiance
FLAG 1824 16 0
FLAG 2288 384 0
FLAG 2064 320 0
FLAG 2448 320 0
FLAG 2512 192 vreg
FLAG 2800 544 0
FLAG 3040 192 vref1
FLAG 3040 352 vref2
FLAG 1824 -208 vcap
SYMBOL SM111K06L 160 112 R0
SYMATTR InstName U1
SYMBOL voltage -96 128 R0
SYMATTR InstName Irradiance
SYMATTR Value {illu}
SYMBOL bv -96 272 R0
SYMATTR InstName Environmental_Changes
SYMATTR Value V=2000*white(1000*time)
SYMBOL PowerProducts\\LTC3105 896 288 R0
SYMATTR InstName U2
SYMBOL cap 1152 416 R0
SYMATTR InstName LTC_C1
SYMATTR Value 4.7µ
SYMBOL res 1280 208 R0
SYMATTR InstName R1
SYMATTR Value 390k
SYMBOL res 1280 384 R0
SYMATTR InstName R2
SYMATTR Value 150k
SYMBOL res 720 272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rmppc
SYMATTR Value 300k
SYMBOL cap 608 112 R0
SYMATTR InstName LTC_C2
SYMATTR Value 10µ
SYMBOL ind 832 16 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName LTC_L1
SYMATTR Value 10µ
SYMBOL cap 1392 224 R0
SYMATTR InstName LTC_C3
SYMATTR Value 10µ
SYMBOL cap 624 512 R0
SYMATTR InstName LTC_C4
SYMATTR Value 1µ
SYMBOL cap 1808 288 R0
SYMATTR InstName C_backup
SYMATTR Value 220µ
SYMBOL Misc\\jumper 1696 -272 R0
SYMATTR InstName X1
SYMBOL cap 1808 -112 R0
SYMATTR InstName C_heart
SYMATTR Value 4.7µ
SYMBOL schottky 1632 208 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value BAT54
SYMBOL PowerProducts\\ADP160-3.0 2288 304 R0
SYMATTR InstName U3
SYMBOL cap 2048 224 R0
SYMATTR InstName ADP_C1
SYMATTR Value 1µ
SYMBOL cap 2432 224 R0
SYMATTR InstName ADP_C2
SYMATTR Value 1µ
SYMBOL res 2784 208 R0
SYMATTR InstName Rref1
SYMATTR Value 1Meg
SYMBOL res 2784 384 R0
SYMATTR InstName Rref2
SYMATTR Value 2Meg
SYMBOL Misc\\jumper 2944 128 R0
SYMATTR InstName X2
SYMBOL schottky 1616 -16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value BAT54
TEXT 88 16 Left 2 !.param illu 1000
TEXT 88 -8 Left 2 !.temp 25
TEXT -616 472 Left 2 ;How does WHITE() work in a arbitrary voltage behavioral supply? \n1) white(time) generates 1 random value between -500mV and 500mV every second\n2) x*white(time) generates 1 random value between x*(-500mV) and x*500mV every second\n3) white(y*time) generates y random values between -500mV and 500mV every second
TEXT 608 672 Left 2 ;LTC3105 connected following the datasheet\nSome notes:\n1) FBLDO connected to GND sets LDO output voltage to 2.2V\n2) all LTC_* components are placed for the IC's correct behavior. Check datasheet for the values\n3) if SHDN isn't connected, it's always at HIGH and it keeps the IC always ON\n4) Vout range can be set between 1.6V and 5.25V\n5) LTC_C2 e LTC_C3 (decoupling ceramic C) require to be placed as near as possible to the IC with a wide trace\n6) PGOOD is an output that becomes HIGH when "IC is working as programmed"\n7) LTC_C4 ceramic capacitor is used for the initial IC's startup\n8) LTC_L1 (low DCR power inductor) requires to be placed as close as possible to the IC with the shortest trace possible\n9) The inductor can be between 4.7uH and 30uH. With smaller Vin is suggested to have a inductor with a higher value
TEXT 608 1016 Left 2 ;Value of Rmppc is selected with this formula:\nVmppc = 10uA*Rmppc\nSince SM111K06L has Vmmpc = 3.35V, I selected a 300K resistor.\nN.B.: It's better if the Vmmpc set on the IC is slightly lower than higher, because the curve of the Power graph is less sloped\n \nValues of R1 and R2 are selected with this formula:\nVout = 1.004*(1+(R1/R2))\nConsidering that SM111K06L has a maximum power point at 3.35V (Vin), we want Vout > Vin to not reduce efficiency, although the IC can work with Vin > Vout\nSo, we calculated R1 and R2 based on Vout = 3.6V
TEXT -120 -168 Left 2 !.tran 50m startup
TEXT 816 -56 Left 2 !.ic I(LTC_L1) = 0
TEXT 1368 168 Left 2 !.ic V(ltc_out) = 0
TEXT 1160 544 Left 2 !.ic V(vldo) = 0
TEXT 576 440 Left 2 !.ic V(vaux) = 0
TEXT 1832 376 Left 2 !.ic V(vbackup) = 0
TEXT 1976 -208 Left 2 ;For now, C_heart is selected only based on this supposition:\n1) Tcharge < Tdischarge\n \nTo guarantee a rapid charge time we prefer a low capacitance... we can adjust the discharge time based on the load resistor\nN.B.: it's important to respect that condition also because we will have multiple C charging while the other is discharging
TEXT 1512 464 Left 2 ;This C_backup needs to have low ESR\nConsidering that it will be used to power a small logic with low consumption, i suppose that it can be enough
TEXT 1832 -24 Left 2 !.ic V(vcap) = 0
TEXT -120 -192 Left 2 ;On my pc, even small simulations demand a lot of time to be processed
TEXT 1424 -328 Left 2 ;ltc_out is the voltage that directly charges the heartbeat capacitors (TBD...)\nThe circuitry next to the schottky diode is to get a regulated voltage to power the logic of the system
TEXT 2040 112 Left 2 ;All ADP_* components are placed for the IC's correct behavior. Check datasheet for the values
TEXT 3152 232 Left 2 ;Rref1 and Rref2 are used to get fixed regulated output values\nWith this configuration we obtain:\n1) vref1 = 3V (equale to vreg)\n2) vref2 = 2V
TEXT 2456 304 Left 2 !.ic V(vreg) = 0
